import{Ma as p,e as u,h as s,j as n,l as i,p as c,s as g}from"./chunk-X3WSSSVM.js";var m={production:!0,apiUrl:"https://course-organizer-backend-production.up.railway.app/api"};var h=class o{constructor(e){this.http=e;this.checkExistingSession()}currentUserSubject=new u(null);currentUser$=this.currentUserSubject.asObservable();apiUrl=m.apiUrl;checkExistingSession(){let e=localStorage.getItem("currentUser");if(e)try{let t=JSON.parse(e);this.currentUserSubject.next(t)}catch{localStorage.removeItem("currentUser")}}login(e,t){let a={email:e,password:t};return this.http.post(`${this.apiUrl}/directory/auth/login/`,a).pipe(n(r=>(localStorage.setItem("authToken",r.token),localStorage.setItem("currentUser",JSON.stringify(r.user)),this.currentUserSubject.next(r.user),!0)),i(r=>(console.error("Login error:",r),s(()=>r))))}register(e){return this.http.post(`${this.apiUrl}/directory/register/student/`,e).pipe(n(t=>(console.log("Registration successful:",t),t)),i(t=>(console.error("Registration error:",t),s(()=>t))))}logout(){return this.http.post(`${this.apiUrl}/directory/auth/logout/`,{}).pipe(n(e=>(this.currentUserSubject.next(null),localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),console.log("Logout successful:",e.message||"Logged out"),e)),i(e=>(console.warn("Logout request failed, but clearing local data:",e),this.currentUserSubject.next(null),localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"),s(()=>e))))}getCurrentUser(){return this.currentUserSubject.value}isAuthenticated(){return this.currentUserSubject.value!==null&&!!localStorage.getItem("authToken")}isAdmin(){let e=this.getCurrentUser();return e!==null&&e.is_admin===!0}refreshUserData(){return this.http.get(`${this.apiUrl}/directory/auth/profile/`).pipe(n(e=>(localStorage.setItem("currentUser",JSON.stringify(e)),this.currentUserSubject.next(e),e)),i(e=>(console.error("Error refreshing user data:",e),s(()=>e))))}getAuthToken(){return localStorage.getItem("authToken")}getPendingRegistrations(){return console.log("Making API call to:",`${this.apiUrl}/admin/pending-registrations/`),console.log("Auth token:",this.getAuthToken()?"Present":"Missing"),this.http.get(`${this.apiUrl}/admin/pending-registrations/`)}getConfirmedRegistrations(){return console.log("Making API call to:",`${this.apiUrl}/admin/confirmed-registrations/`),this.http.get(`${this.apiUrl}/admin/confirmed-registrations/`)}approveUser(e){return this.http.post(`${this.apiUrl}/admin/approve-user/${e}/`,{})}rejectUser(e){return this.http.post(`${this.apiUrl}/admin/reject-user/${e}/`,{})}getTimetableEntries(e,t){let a=`${this.apiUrl}/timetable/`,r=[];return e&&r.push(`year=${e}`),t&&r.push(`semester=${t}`),r.length>0&&(a+=`?${r.join("&")}`),this.http.get(a).pipe(n(l=>l.results?l.results:l))}createTimetableEntry(e){return this.http.post(`${this.apiUrl}/timetable/create/`,e)}updateTimetableEntry(e,t){return this.http.put(`${this.apiUrl}/timetable/${e}/update/`,t)}deleteTimetableEntry(e){return this.http.delete(`${this.apiUrl}/timetable/${e}/delete/`)}static \u0275fac=function(t){return new(t||o)(g(p))};static \u0275prov=c({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a,h as b};
