import{a as me}from"./chunk-E7AMMPSB.js";import"./chunk-FHQFZ7BW.js";import{b as X,c as ee,d as te,e as ie,f as ne,g as oe,i as re,j as le,k as ae,q as se}from"./chunk-DHWRSAE3.js";import{a as ce}from"./chunk-CJME7ZFP.js";import{a as de}from"./chunk-R3RPSZJZ.js";import{b as K}from"./chunk-E25IYVGI.js";import{Ba as J,Fa as Y,G as d,Ga as Z,I as w,J as z,Ja as Q,N as g,Ra as q,U as u,V as o,W as l,X as x,Y as f,Z as v,_ as s,a as U,fa as T,ga as S,ha as R,ia as c,ja as h,ka as N,la as P,na as k,oa as V,p as W,pa as I,u as _,v as p,w as C,x as y}from"./chunk-X3WSSSVM.js";var M=class r{constructor(){}generateICS(t){let e=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Course Organizer//UoN Law//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH"];return t.forEach(i=>{let n=this.formatDateForICS(i.start),a=this.formatDateForICS(i.end);e.push("BEGIN:VEVENT",`UID:${i.id}@courseorganizer.uon.ac.ke`,`DTSTART:${n}`,`DTEND:${a}`,`SUMMARY:${i.course}`,`DESCRIPTION:${i.description||`${i.course} - ${i.lecturer}`}`,`LOCATION:${i.location}`,"STATUS:CONFIRMED","TRANSP:OPAQUE","END:VEVENT")}),e.push("END:VCALENDAR"),e.join(`\r
`)}downloadICS(t,e="uon-law-timetable.ics"){let i=this.generateICS(t),n=new Blob([i],{type:"text/calendar;charset=utf-8"}),a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=e,a.click(),window.URL.revokeObjectURL(a.href)}generateGoogleCalendarURL(t){let e=this.formatDateForGoogle(t.start),i=this.formatDateForGoogle(t.end),n=encodeURIComponent(t.course),a=encodeURIComponent(`${t.course} - ${t.lecturer}`),m=encodeURIComponent(t.location);return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${n}&dates=${e}/${i}&details=${a}&location=${m}`}generateOutlookCalendarURL(t){let e=this.formatDateForOutlook(t.start),i=this.formatDateForOutlook(t.end),n=encodeURIComponent(t.course),a=encodeURIComponent(`${t.course} - ${t.lecturer}`),m=encodeURIComponent(t.location);return`https://outlook.live.com/calendar/0/deeplink/compose?subject=${n}&startdt=${e}&enddt=${i}&body=${a}&location=${m}`}addToDeviceCalendar(t){navigator.share?navigator.share({title:t.course,text:`${t.course} - ${t.lecturer}`,url:this.generateGoogleCalendarURL(t)}).catch(console.error):window.open(this.generateGoogleCalendarURL(t),"_blank")}getCalendarOptions(t){return[{name:"Google Calendar",icon:"\u{1F4C5}",action:()=>window.open(this.generateGoogleCalendarURL(t),"_blank")},{name:"Outlook",icon:"\u{1F4E7}",action:()=>window.open(this.generateOutlookCalendarURL(t),"_blank")},{name:"Download ICS",icon:"\u2B07\uFE0F",action:()=>this.downloadICS([t],`${t.course.replace(/\s+/g,"-").toLowerCase()}.ics`)},{name:"Share",icon:"\u{1F4E4}",action:()=>this.addToDeviceCalendar(t)}]}formatDateForICS(t){return t.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}formatDateForGoogle(t){return t.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}formatDateForOutlook(t){return t.toISOString()}getCurrentWeekDates(){let t=new Date,e=new Date(t),i=t.getDay(),n=i===0?-6:1-i;return e.setDate(t.getDate()+n),["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].map((m,b)=>{let E=new Date(e);return E.setDate(e.getDate()+b),{day:m,date:E}})}isEventToday(t){let e=new Date;return t.start.toDateString()===e.toDateString()}isEventThisWeek(t){let e=new Date,i=t.start,n=new Date(e);n.setDate(e.getDate()-e.getDay()+1);let a=new Date(n);return a.setDate(n.getDate()+6),i>=n&&i<=a}getUpcomingEvents(t){let e=new Date,i=new Date(e);return i.setDate(e.getDate()+7),t.filter(n=>n.start>=e&&n.start<=i).sort((n,a)=>n.start.getTime()-a.start.getTime())}static \u0275fac=function(e){return new(e||r)};static \u0275prov=W({token:r,factory:r.\u0275fac,providedIn:"root"})};function xe(r,t){r&1&&(o(0,"div",3)(1,"div",4)(2,"div",5),x(3,"div",6),o(4,"div",7)(5,"h3",8),c(6,"Loading Timetable"),l(),o(7,"p",9),c(8,"Fetching your class schedule..."),l()()()()())}function be(r,t){if(r&1&&(o(0,"th",34)(1,"div",35),c(2),l(),o(3,"div",36),c(4),l()()),r&2){let e=t.$implicit,i=s(3);S("bg-blue-50",i.isToday(e))("text-blue-600",i.isToday(e))("text-gray-500",!i.isToday(e)),d(),S("text-blue-900",i.isToday(e))("text-gray-900",!i.isToday(e)),d(),h(e),d(),S("text-blue-500",i.isToday(e))("text-gray-500",!i.isToday(e)),d(),h(i.getDayDate(e))}}function fe(r,t){if(r&1&&(o(0,"div",46),x(1,"div",47),l()),r&2){let e=s(2).$implicit,i=s(3);T("top",i.getCurrentTimePositionInSlot(e).top)}}function he(r,t){if(r&1){let e=f();o(0,"button",60),v("click",function(){_(e);let n=s(2).$implicit,a=s(5);return p(a.joinVideoCall(a.getTimetableEntryFromEvent(n)))}),c(1," \u{1F4F9} Join Video Call "),l()}if(r&2){let e=s(2).$implicit,i=s(5);u("title",i.getVideoCallButtonTooltip(i.getTimetableEntryFromEvent(e)))}}function Ee(r,t){if(r&1&&(o(0,"button",61),c(1," \u{1F4F9} Video Call Scheduled "),l()),r&2){let e=s(2).$implicit,i=s(5);u("title",i.getVideoCallButtonTooltip(i.getTimetableEntryFromEvent(e)))}}function Ce(r,t){if(r&1){let e=f();o(0,"button",62),v("click",function(){_(e);let n=s(2).$implicit,a=s(5);return p(a.createVideoCall(a.getTimetableEntryFromEvent(n)))}),c(1," \u{1F4F9} Create Video Call "),l()}if(r&2){let e=s(2).$implicit,i=s(5);u("title",i.getVideoCallButtonTooltip(i.getTimetableEntryFromEvent(e)))}}function ye(r,t){if(r&1&&(o(0,"div",51)(1,"div",52),c(2),l(),o(3,"div",53),c(4),l(),o(5,"div",54),c(6),l(),o(7,"div",55),c(8),l(),o(9,"div",56),g(10,he,2,1,"button",57)(11,Ee,2,1,"button",58)(12,Ce,2,1,"button",59),l()()),r&2){let e=s().$implicit,i=s(5);d(2),h(e.course),d(2),h(e.location),d(2),h(e.lecturer),d(2),h(e.time),d(2),u("ngIf",e.has_meeting&&e.can_join_meeting),d(),u("ngIf",e.has_meeting&&!e.can_join_meeting),d(),u("ngIf",!e.has_meeting&&i.isAdmin)}}function we(r,t){if(r&1&&(o(0,"div",63),x(1,"div",64),l()),r&2){let e=s().$implicit;d(),T("background-color",e.color)}}function Te(r,t){if(r&1){let e=f();o(0,"div",48),v("click",function(){let n=_(e).$implicit,a=s(5);return p(a.selectEvent(n))}),g(1,ye,13,7,"div",49)(2,we,2,2,"div",50),l()}if(r&2){let e=t.$implicit,i=s(2).$implicit,n=s(3);T("background-color",e.color+"20")("border-left-color",e.color)("height",n.getEventDisplayInfo(e,i).height),S("absolute",n.getEventDisplayInfo(e,i).position==="absolute")("relative",n.getEventDisplayInfo(e,i).position==="relative")("left-0",n.getEventDisplayInfo(e,i).position==="absolute")("right-0",n.getEventDisplayInfo(e,i).position==="absolute")("bottom-0",n.getEventDisplayInfo(e,i).alignment==="bottom-0")("top-0",n.getEventDisplayInfo(e,i).alignment==="top-0"),d(),u("ngIf",n.getEventDisplayInfo(e,i).showInfo),d(),u("ngIf",!n.getEventDisplayInfo(e,i).showInfo)}}function Se(r,t){r&1&&(o(0,"div",65),x(1,"div",66),l())}function De(r,t){if(r&1&&(o(0,"td",41),g(1,fe,2,2,"div",42),o(2,"div",43),g(3,Te,3,20,"div",44)(4,Se,2,0,"div",45),l()()),r&2){let e=t.$implicit,i=s().$implicit,n=s(3);S("bg-blue-50",n.isToday(e)),d(),u("ngIf",n.isToday(e)&&n.isCurrentTimeInSlot(i)),d(2),u("ngForOf",n.getEventsForDayAndTime(e,i)),d(),u("ngIf",n.getEventsForDayAndTime(e,i).length===0)}}function ke(r,t){if(r&1&&(o(0,"tr",37)(1,"td",38)(2,"div",39),c(3),l()(),g(4,De,5,5,"td",40),l()),r&2){let e=t.$implicit,i=s(3);d(3),P("",e," - ",i.getNextTimeSlot(e)),d(),u("ngForOf",i.days)}}function Ve(r,t){if(r&1&&(o(0,"div",26)(1,"div",27)(2,"table",28)(3,"thead",29)(4,"tr")(5,"th",30),c(6," Time "),l(),g(7,be,5,16,"th",31),l()(),o(8,"tbody",32),g(9,ke,5,3,"tr",33),l()()()()),r&2){let e=s(2);d(7),u("ngForOf",e.days),d(2),u("ngForOf",e.timeSlots)}}function Ie(r,t){if(r&1){let e=f();o(0,"button",92),v("click",function(n){_(e);let a=s().$implicit,m=s(4);return m.joinVideoCall(m.getTimetableEntryFromEvent(a)),p(n.stopPropagation())}),c(1," \u{1F4F9} Join Video Call "),l()}if(r&2){let e=s().$implicit,i=s(4);u("title",i.getVideoCallButtonTooltip(i.getTimetableEntryFromEvent(e)))}}function Fe(r,t){if(r&1&&(o(0,"button",93),c(1," \u{1F4F9} Video Call Scheduled "),l()),r&2){let e=s().$implicit,i=s(4);u("title",i.getVideoCallButtonTooltip(i.getTimetableEntryFromEvent(e)))}}function Me(r,t){if(r&1){let e=f();o(0,"button",94),v("click",function(n){_(e);let a=s().$implicit,m=s(4);return m.createVideoCall(m.getTimetableEntryFromEvent(a)),p(n.stopPropagation())}),c(1," \u{1F4F9} Create Video Call "),l()}if(r&2){let e=s().$implicit,i=s(4);u("title",i.getVideoCallButtonTooltip(i.getTimetableEntryFromEvent(e)))}}function Oe(r,t){if(r&1){let e=f();o(0,"div",76),v("click",function(){let n=_(e).$implicit,a=s(4);return p(a.selectEvent(n))}),o(1,"div",77)(2,"div",78)(3,"div",79),c(4),l(),o(5,"div",80),c(6),l(),o(7,"div",81)(8,"div",82),C(),o(9,"svg",83),x(10,"path",84),l(),c(11),l(),y(),o(12,"div",82),C(),o(13,"svg",83),x(14,"path",85)(15,"path",86),l(),c(16),l()(),y(),o(17,"div",56),g(18,Ie,2,1,"button",87)(19,Fe,2,1,"button",88)(20,Me,2,1,"button",89),l()(),o(21,"div",90),x(22,"div",91),l()()()}if(r&2){let e=t.$implicit,i=s(4);T("border-left-color",e.color)("background-color",e.color+"10"),d(4),h(e.course),d(2),h(e.title),d(5),N(" ",e.time," "),d(5),N(" ",e.location," "),d(2),u("ngIf",e.has_meeting&&e.can_join_meeting),d(),u("ngIf",e.has_meeting&&!e.can_join_meeting),d(),u("ngIf",!e.has_meeting&&i.isAdmin),d(2),T("background-color",e.color)}}function Le(r,t){r&1&&(o(0,"div",95),C(),o(1,"svg",96),x(2,"path",97),l(),y(),o(3,"div",98),c(4,"No classes"),l()())}function $e(r,t){if(r&1&&(o(0,"div",69)(1,"div",70)(2,"h4",71),c(3),l(),o(4,"div",72),c(5),l()(),o(6,"div",73),g(7,Oe,23,13,"div",74)(8,Le,5,0,"div",75),l()()),r&2){let e=t.$implicit,i=s(3);d(3),h(e),d(2),h(i.getDayDate(e)),d(2),u("ngForOf",i.getEventsForDay(e)),d(),u("ngIf",i.getEventsForDay(e).length===0)}}function je(r,t){if(r&1&&(o(0,"div",26)(1,"div",4)(2,"div",67),g(3,$e,9,4,"div",68),l()()()),r&2){let e=s(2);d(3),u("ngForOf",e.days)}}function He(r,t){if(r&1){let e=f();o(0,"div",110)(1,"button",120),v("click",function(){_(e);let n=s(3);return p(n.editEvent())}),c(2," Edit "),l(),o(3,"button",121),v("click",function(){_(e);let n=s(3);return p(n.deleteEvent())}),c(4," Delete "),l()()}}function Ae(r,t){if(r&1){let e=f();o(0,"button",122),v("click",function(){_(e);let n=s(3);return p(n.joinVideoCall(n.getTimetableEntryFromEvent(n.selectedEvent)))}),c(1," \u{1F4F9} Join Video Call "),l()}if(r&2){let e=s(3);u("title",e.getVideoCallButtonTooltip(e.getTimetableEntryFromEvent(e.selectedEvent)))}}function Re(r,t){if(r&1&&(o(0,"button",123),c(1," \u{1F4F9} Video Call Scheduled "),l()),r&2){let e=s(3);u("title",e.getVideoCallButtonTooltip(e.getTimetableEntryFromEvent(e.selectedEvent)))}}function Ne(r,t){if(r&1){let e=f();o(0,"button",124),v("click",function(){_(e);let n=s(3);return p(n.createVideoCall(n.getTimetableEntryFromEvent(n.selectedEvent)))}),c(1," \u{1F4F9} Create Video Call "),l()}if(r&2){let e=s(3);u("title",e.getVideoCallButtonTooltip(e.getTimetableEntryFromEvent(e.selectedEvent)))}}function Pe(r,t){if(r&1){let e=f();o(0,"button",125),v("click",function(){_(e);let n=s(3);return p(n.deleteVideoCall(n.getTimetableEntryFromEvent(n.selectedEvent)))}),c(1," \u{1F5D1}\uFE0F Delete Video Call "),l()}}function Be(r,t){if(r&1){let e=f();o(0,"div",126)(1,"div",127)(2,"button",128),v("click",function(){_(e);let n=s(3);return p(n.addToGoogleCalendar())}),o(3,"span",129),c(4,"\u{1F4C5}"),l(),c(5," Google Calendar "),l(),o(6,"button",128),v("click",function(){_(e);let n=s(3);return p(n.addToOutlook())}),o(7,"span",129),c(8,"\u{1F4E7}"),l(),c(9," Outlook "),l(),o(10,"button",128),v("click",function(){_(e);let n=s(3);return p(n.downloadICS())}),o(11,"span",129),c(12,"\u2B07\uFE0F"),l(),c(13," Download ICS "),l(),o(14,"button",128),v("click",function(){_(e);let n=s(3);return p(n.shareEvent())}),o(15,"span",129),c(16,"\u{1F4E4}"),l(),c(17," Share "),l()()()}}function Ge(r,t){if(r&1&&(o(0,"option",140),c(1),l()),r&2){let e=t.$implicit;u("value",e),d(),h(e)}}function Ue(r,t){if(r&1){let e=f();o(0,"div",99),v("click",function(){_(e);let n=s(3);return p(n.closeEditModal())}),o(1,"div",100),v("click",function(n){return _(e),p(n.stopPropagation())}),o(2,"div",101)(3,"div",70)(4,"h3",14),c(5,"Edit Lesson Time"),l(),o(6,"button",102),v("click",function(){_(e);let n=s(3);return p(n.closeEditModal())}),C(),o(7,"svg",103),x(8,"path",104),l()()(),y(),o(9,"form",130),v("ngSubmit",function(){_(e);let n=s(3);return p(n.saveEventChanges())}),o(10,"div")(11,"label",131),c(12,"Day"),l(),o(13,"select",132),I("ngModelChange",function(n){_(e);let a=s(3);return V(a.editingEvent.day,n)||(a.editingEvent.day=n),p(n)}),g(14,Ge,2,2,"option",133),l()(),o(15,"div")(16,"label",131),c(17,"Time"),l(),o(18,"input",134),I("ngModelChange",function(n){_(e);let a=s(3);return V(a.editingEvent.time,n)||(a.editingEvent.time=n),p(n)}),l()(),o(19,"div")(20,"label",131),c(21,"Location"),l(),o(22,"input",135),I("ngModelChange",function(n){_(e);let a=s(3);return V(a.editingEvent.location,n)||(a.editingEvent.location=n),p(n)}),l()(),o(23,"div")(24,"label",131),c(25,"Lecturer"),l(),o(26,"input",136),I("ngModelChange",function(n){_(e);let a=s(3);return V(a.editingEvent.lecturer,n)||(a.editingEvent.lecturer=n),p(n)}),l()(),o(27,"div",137)(28,"button",138),v("click",function(){_(e);let n=s(3);return p(n.closeEditModal())}),c(29," Cancel "),l(),o(30,"button",139),c(31," Save Changes "),l()()()()()()}if(r&2){let e=s(3);d(13),k("ngModel",e.editingEvent.day),d(),u("ngForOf",e.days),d(4),k("ngModel",e.editingEvent.time),d(4),k("ngModel",e.editingEvent.location),d(4),k("ngModel",e.editingEvent.lecturer)}}function We(r,t){r&1&&(o(0,"div",26)(1,"div",141),C(),o(2,"svg",142),x(3,"path",17),l(),y(),o(4,"h3",143),c(5,"No classes scheduled"),l(),o(6,"p",144),c(7,"Your timetable will appear here once classes are scheduled."),l()()())}function ze(r,t){if(r&1){let e=f();o(0,"div",99),v("click",function(){_(e);let n=s(2);return p(n.closeEventDetails())}),o(1,"div",100),v("click",function(n){return _(e),p(n.stopPropagation())}),o(2,"div",101)(3,"div",70)(4,"h3",14),c(5),l(),o(6,"button",102),v("click",function(){_(e);let n=s(2);return p(n.closeEventDetails())}),C(),o(7,"svg",103),x(8,"path",104),l()()(),y(),o(9,"div",73)(10,"div",82),C(),o(11,"svg",105),x(12,"path",84),l(),y(),o(13,"span",106),c(14),l()(),o(15,"div",82),C(),o(16,"svg",105),x(17,"path",85)(18,"path",86),l(),y(),o(19,"span",106),c(20),l()(),o(21,"div",82),C(),o(22,"svg",105),x(23,"path",107),l(),y(),o(24,"span",106),c(25),l()()(),o(26,"div",108),g(27,He,5,0,"div",109),o(28,"div",110),g(29,Ae,2,1,"button",111)(30,Re,2,1,"button",112)(31,Ne,2,1,"button",113)(32,Pe,2,0,"button",114),l(),o(33,"div",115)(34,"button",116),v("click",function(){_(e);let n=s(2);return p(n.closeEventDetails())}),c(35," Close "),l(),o(36,"div",117)(37,"button",118),v("click",function(){_(e);let n=s(2);return p(n.toggleCalendarOptions())}),c(38," Add to Calendar "),l(),g(39,Be,18,0,"div",119),l()()()()(),g(40,Ue,32,5,"div",25)(41,We,8,0,"div",24),l()}if(r&2){let e,i,n,a,m=s(2);d(5),h(m.selectedEvent.course),d(9),P("",m.selectedEvent.day," at ",m.selectedEvent.time),d(6),h(m.selectedEvent.location),d(5),h(m.selectedEvent.lecturer),d(2),u("ngIf",m.isAdmin),d(2),u("ngIf",((e=m.getTimetableEntryFromEvent(m.selectedEvent))==null?null:e.has_meeting)&&((e=m.getTimetableEntryFromEvent(m.selectedEvent))==null?null:e.can_join_meeting)),d(),u("ngIf",((i=m.getTimetableEntryFromEvent(m.selectedEvent))==null?null:i.has_meeting)&&!((i=m.getTimetableEntryFromEvent(m.selectedEvent))!=null&&i.can_join_meeting)),d(),u("ngIf",!((n=m.getTimetableEntryFromEvent(m.selectedEvent))!=null&&n.has_meeting)&&m.isAdmin),d(),u("ngIf",((a=m.getTimetableEntryFromEvent(m.selectedEvent))==null?null:a.has_meeting)&&m.isAdmin),d(5),T("background-color",m.selectedEvent.color),d(2),u("ngIf",m.showCalendarOptions),d(),u("ngIf",m.showEditModal),d(),u("ngIf",m.timetable.length===0&&!m.isLoading)}}function Je(r,t){if(r&1){let e=f();o(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"h3",14),c(5,"Weekly Schedule"),l(),o(6,"div",15),C(),o(7,"svg",16),x(8,"path",17),l(),y(),o(9,"span"),c(10,"Academic Year 2025/2026 - First Semester"),l()()(),o(11,"div",18)(12,"button",19),v("click",function(){_(e);let n=s();return p(n.downloadFullTimetable())}),C(),o(13,"svg",20),x(14,"path",21),l(),c(15," Download Timetable "),l(),y(),o(16,"div",22)(17,"button",23),v("click",function(){_(e);let n=s();return p(n.viewMode="grid")}),c(18," Grid View "),l(),o(19,"button",23),v("click",function(){_(e);let n=s();return p(n.viewMode="calendar")}),c(20," Calendar View "),l()()()()(),g(21,Ve,10,2,"div",24)(22,je,4,1,"div",24)(23,ze,42,15,"div",25),l()}if(r&2){let e=s();d(17),R(e.viewMode==="grid"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"),d(2),R(e.viewMode==="calendar"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"),d(2),u("ngIf",e.viewMode==="grid"),d(),u("ngIf",e.viewMode==="calendar"),d(),u("ngIf",e.selectedEvent)}}var ue=class r{constructor(t,e,i,n,a,m){this.courseService=t;this.authService=e;this.calendarService=i;this.videoCallService=n;this.cdr=a;this.router=m}timetable=[];calendarEvents=[];isLoading=!0;isSidebarOpen=!1;viewMode="grid";selectedEvent=null;showCalendarOptions=!1;isAdmin=!1;editingEvent=null;showEditModal=!1;days=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];timeSlots=["08:00","10:00","12:00","14:00","16:00","18:00","20:00"];courseColors=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16"];ngOnInit(){this.authService.isAuthenticated()?(this.isAdmin=this.authService.isAdmin(),this.loadTimetable()):this.isLoading=!1}onSidebarToggle(t){this.isSidebarOpen=t}loadTimetable(){this.isLoading=!0,this.courseService.getTimetableWithMeetings().subscribe({next:t=>{this.timetable=t,this.calendarEvents=this.convertToCalendarEvents(t),this.isLoading=!1,this.cdr.detectChanges()},error:t=>{console.error("Error loading timetable:",t),this.isLoading=!1,this.cdr.detectChanges()}})}convertToCalendarEvents(t){return t.map((e,i)=>{let n=this.courseColors[i%this.courseColors.length],[a,m]=e.time.split(" - ");return{id:`${e.day}-${e.time}`,title:e.subject,start:this.createDateFromTime(a),end:this.createDateFromTime(m),location:e.location,lecturer:e.lecturer,course:e.subject,color:n,day:e.day,time:e.time,has_meeting:e.has_meeting,can_join_meeting:e.can_join_meeting,meeting_id:e.meeting_id}})}createDateFromTime(t){let[e,i]=t.split(":").map(Number),n=new Date;return n.setHours(e,i,0,0),n}getEventsForDay(t){return this.calendarEvents.filter(e=>e.day.toLowerCase()===t.toLowerCase()).sort((e,i)=>e.start.getTime()-i.start.getTime())}getEventsForDayAndTime(t,e){return this.calendarEvents.filter(i=>{if(!(i.day.toLowerCase()===t.toLowerCase()))return!1;let a=parseInt(e.split(":")[0]),m=a,b=a+2,E=i.start.getHours(),D=i.start.getMinutes(),F=i.end.getHours(),O=i.end.getMinutes(),L=E+D/60,B=F+O/60;return L<b&&B>m})}getEventDisplayInfo(t,e){let i=parseInt(e.split(":")[0]),n=i,a=i+2,m=t.start.getHours(),b=t.start.getMinutes(),E=t.end.getHours(),D=t.end.getMinutes(),F=m+b/60,O=E+D/60,L=Math.max(F,n),_e=Math.min(O,a)-L,pe=a-n,$=_e/pe*100,G="100%",j="relative",H="",A=!0;return $<100&&(G=`${Math.max($,25)}%`,F>=n?(j="absolute",H="bottom-0",A=$>50):(j="relative",H="top-0",A=!1)),{showInfo:A,height:G,position:j,alignment:H}}getDayDate(t){let e=new Date,i=this.days.indexOf(t),n=e.getDay()-1,a=new Date(e),m=(n+7)%7;a.setDate(e.getDate()-m);let b=new Date(a);return b.setDate(a.getDate()+i),b.toLocaleDateString("en-US",{month:"short",day:"numeric"})}getNextTimeSlot(t){let[e,i]=t.split(":").map(Number);return`${(e+2).toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}isToday(t){let e=new Date,i=this.days.indexOf(t),n=e.getDay()-1;return i===n}getCurrentTimePosition(){let t=new Date,e=t.getHours(),i=t.getMinutes(),n=e+i/60;if(n<8||n>22)return{top:"0%",visible:!1};let a=8,b=22-a;return{top:`${(n-a)/b*100}%`,visible:!0}}isCurrentTimeInSlot(t){let e=new Date,i=e.getHours(),n=e.getMinutes(),a=i+n/60,m=parseInt(t.split(":")[0]),b=m,E=m+2;return a>=b&&a<E}getCurrentTimePositionInSlot(t){let e=new Date,i=e.getHours(),n=e.getMinutes(),a=i+n/60,m=parseInt(t.split(":")[0]),b=m,E=m+2;return a<8||a>22||!(a>=b&&a<E)?{top:"0%",visible:!1}:{top:`${(a-b)/(E-b)*100}%`,visible:!0}}selectEvent(t){if(this.isAdmin)this.selectedEvent=t;else{let e=encodeURIComponent(t.course);this.router.navigate(["/course",e])}}closeEventDetails(){this.selectedEvent=null,this.showCalendarOptions=!1}toggleCalendarOptions(){this.showCalendarOptions=!this.showCalendarOptions}addToGoogleCalendar(){if(this.selectedEvent){let t={id:this.selectedEvent.id,title:this.selectedEvent.title,start:this.selectedEvent.start,end:this.selectedEvent.end,location:this.selectedEvent.location,lecturer:this.selectedEvent.lecturer,course:this.selectedEvent.course,description:`${this.selectedEvent.course} - ${this.selectedEvent.lecturer}`};window.open(this.calendarService.generateGoogleCalendarURL(t),"_blank")}this.showCalendarOptions=!1}addToOutlook(){if(this.selectedEvent){let t={id:this.selectedEvent.id,title:this.selectedEvent.title,start:this.selectedEvent.start,end:this.selectedEvent.end,location:this.selectedEvent.location,lecturer:this.selectedEvent.lecturer,course:this.selectedEvent.course,description:`${this.selectedEvent.course} - ${this.selectedEvent.lecturer}`};window.open(this.calendarService.generateOutlookCalendarURL(t),"_blank")}this.showCalendarOptions=!1}downloadICS(){if(this.selectedEvent){let t={id:this.selectedEvent.id,title:this.selectedEvent.title,start:this.selectedEvent.start,end:this.selectedEvent.end,location:this.selectedEvent.location,lecturer:this.selectedEvent.lecturer,course:this.selectedEvent.course,description:`${this.selectedEvent.course} - ${this.selectedEvent.lecturer}`};this.calendarService.downloadICS([t],`${this.selectedEvent.course.replace(/\s+/g,"-").toLowerCase()}.ics`)}this.showCalendarOptions=!1}shareEvent(){if(this.selectedEvent){let t={id:this.selectedEvent.id,title:this.selectedEvent.title,start:this.selectedEvent.start,end:this.selectedEvent.end,location:this.selectedEvent.location,lecturer:this.selectedEvent.lecturer,course:this.selectedEvent.course,description:`${this.selectedEvent.course} - ${this.selectedEvent.lecturer}`};this.calendarService.addToDeviceCalendar(t)}this.showCalendarOptions=!1}downloadFullTimetable(){let t=this.calendarEvents.map(e=>({id:e.id,title:e.title,start:e.start,end:e.end,location:e.location,lecturer:e.lecturer,course:e.course,description:`${e.course} - ${e.lecturer}`}));this.calendarService.downloadICS(t,"uon-law-timetable.ics")}editEvent(){this.selectedEvent&&(this.editingEvent=U({},this.selectedEvent),this.showEditModal=!0,this.closeEventDetails())}deleteEvent(){if(this.selectedEvent&&confirm("Are you sure you want to delete this lesson?")){let t=this.timetable.find(e=>e.day.toLowerCase()===this.selectedEvent.day.toLowerCase()&&e.time===this.selectedEvent.time&&e.subject===this.selectedEvent.course);t&&this.authService.deleteTimetableEntry(t.id).subscribe({next:()=>{this.loadTimetable(),this.closeEventDetails()},error:e=>{console.error("Error deleting timetable entry:",e),alert("Failed to delete lesson. Please try again.")}})}}closeEditModal(){this.showEditModal=!1,this.editingEvent=null}saveEventChanges(){if(this.editingEvent){let t=this.timetable.find(e=>e.day.toLowerCase()===this.editingEvent.day.toLowerCase()&&e.time===this.editingEvent.time&&e.subject===this.editingEvent.course);if(t){let e={day:this.editingEvent.day.toLowerCase(),subject:this.editingEvent.course,time:this.editingEvent.time,location:this.editingEvent.location,lecturer:this.editingEvent.lecturer,course:t.course};this.authService.updateTimetableEntry(t.id,e).subscribe({next:()=>{this.loadTimetable(),this.closeEditModal()},error:i=>{console.error("Error updating timetable entry:",i),alert("Failed to update lesson. Please try again.")}})}}}createVideoCall(t){if(!this.isAdmin){alert("Only administrators can create video calls for classes.");return}this.videoCallService.createVideoCallForTimetable(t.id).subscribe({next:e=>{console.log("Video call created successfully:",e),alert("Video call created successfully! Students can now join the class."),this.loadTimetable()},error:e=>{console.error("Error creating video call:",e),e.error?.message?alert(e.error.message):alert("Error creating video call. Please try again.")}})}joinVideoCall(t){this.videoCallService.joinTimetableMeeting(t.id).subscribe({next:e=>{console.log("Joining video call:",e),this.videoCallService.openEmbeddedVideoCall(e)},error:e=>{console.error("Error joining video call:",e),e.error?.message?alert(e.error.message):alert("Error joining video call. Please try again.")}})}deleteVideoCall(t){if(!this.isAdmin){alert("Only administrators can delete video calls.");return}confirm("Are you sure you want to delete the video call for this class?")&&this.videoCallService.deleteVideoCallForTimetable(t.id).subscribe({next:e=>{console.log("Video call deleted successfully:",e),alert("Video call deleted successfully."),this.loadTimetable()},error:e=>{console.error("Error deleting video call:",e),e.error?.message?alert(e.error.message):alert("Error deleting video call. Please try again.")}})}getVideoCallButtonText(t){return t.has_meeting?t.can_join_meeting?"Join Video Call":"Video Call Scheduled":"Create Video Call"}getVideoCallButtonTooltip(t){return t.has_meeting?t.can_join_meeting?"Click to join the video call":"Video call is scheduled for this class":"Create a video call for this class (Admin only)"}getVideoCallButtonClass(t){return t.has_meeting?t.can_join_meeting?"bg-green-600 hover:bg-green-700 text-white":"bg-blue-600 text-white cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}getTimetableEntryFromEvent(t){return this.timetable.find(e=>e.day.toLowerCase()===t.day.toLowerCase()&&e.time===t.time&&e.subject===t.course)}static \u0275fac=function(e){return new(e||r)(w(ce),w(K),w(M),w(me),w(J),w(q))};static \u0275cmp=z({type:r,selectors:[["app-timetable"]],decls:3,vars:3,consts:[["pageTitle","Class Timetable","pageSubtitle","University of Nairobi - Your weekly schedule at a glance",3,"sidebarToggle","isSidebarOpen"],["class","bg-white border border-gray-200 rounded-2xl overflow-hidden",4,"ngIf"],["class","space-y-6",4,"ngIf"],[1,"bg-white","border","border-gray-200","rounded-2xl","overflow-hidden"],[1,"p-6"],[1,"flex","flex-col","items-center","justify-center","py-16"],[1,"w-16","h-16","border-4","border-gray-200","border-t-gray-900","rounded-full","animate-spin"],[1,"mt-6","text-center"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"space-y-6"],[1,"bg-white","shadow","rounded-lg","p-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-4"],[1,"text-lg","font-medium","text-gray-900"],[1,"flex","items-center","space-x-2","text-sm","text-gray-500"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"flex","items-center","space-x-3"],[1,"flex","items-center","px-3","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-md","hover:bg-gray-50","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-4","h-4","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"],[1,"flex","bg-gray-100","rounded-lg","p-1"],[1,"px-3","py-1","rounded-md","text-sm","font-medium","transition-colors",3,"click"],["class","bg-white shadow rounded-lg overflow-hidden",4,"ngIf"],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",3,"click",4,"ngIf"],[1,"bg-white","shadow","rounded-lg","overflow-hidden"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],[1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","w-20"],["class","px-4 py-3 text-center text-xs font-medium uppercase tracking-wider",3,"bg-blue-50","text-blue-600","text-gray-500",4,"ngFor","ngForOf"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"px-4","py-3","text-center","text-xs","font-medium","uppercase","tracking-wider"],[1,"font-semibold"],[1,"text-xs","mt-1"],[1,"hover:bg-gray-50"],[1,"px-4","py-4","whitespace-nowrap","bg-gray-50","border-r","border-gray-200"],[1,"text-sm","font-medium","text-gray-900","text-center"],["class","px-2 py-4 align-top border-r border-gray-200 h-32 relative",3,"bg-blue-50",4,"ngFor","ngForOf"],[1,"px-2","py-4","align-top","border-r","border-gray-200","h-32","relative"],["class","absolute left-0 right-0 h-0.5 bg-red-500 z-10",3,"top",4,"ngIf"],[1,"relative","h-full","w-full"],["class","rounded-md text-xs cursor-pointer transition-all hover:shadow-md border-l-4 mb-1 overflow-hidden",3,"absolute","relative","left-0","right-0","bottom-0","top-0","background-color","border-left-color","height","click",4,"ngFor","ngForOf"],["class","h-16 flex items-center justify-center text-gray-300",4,"ngIf"],[1,"absolute","left-0","right-0","h-0.5","bg-red-500","z-10"],[1,"absolute","-left-1","-top-1","w-2","h-2","bg-red-500","rounded-full"],[1,"rounded-md","text-xs","cursor-pointer","transition-all","hover:shadow-md","border-l-4","mb-1","overflow-hidden",3,"click"],["class","p-2",4,"ngIf"],["class","flex items-center justify-center h-full",4,"ngIf"],[1,"p-2"],[1,"font-semibold","text-gray-900","truncate","text-xs"],[1,"text-gray-600","truncate","text-xs","mt-1"],[1,"text-gray-500","truncate","text-xs"],[1,"text-gray-400","truncate","text-xs","mt-1"],[1,"mt-2"],["class","w-full px-2 py-1 text-xs bg-green-600 hover:bg-green-700 text-white rounded transition-colors cursor-pointer",3,"title","click",4,"ngIf"],["class","w-full px-2 py-1 text-xs bg-blue-600 text-white rounded cursor-not-allowed opacity-75",3,"title",4,"ngIf"],["class","w-full px-2 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors cursor-pointer",3,"title","click",4,"ngIf"],[1,"w-full","px-2","py-1","text-xs","bg-green-600","hover:bg-green-700","text-white","rounded","transition-colors","cursor-pointer",3,"click","title"],[1,"w-full","px-2","py-1","text-xs","bg-blue-600","text-white","rounded","cursor-not-allowed","opacity-75",3,"title"],[1,"w-full","px-2","py-1","text-xs","bg-blue-600","hover:bg-blue-700","text-white","rounded","transition-colors","cursor-pointer",3,"click","title"],[1,"flex","items-center","justify-center","h-full"],[1,"w-2","h-2","rounded-full","opacity-50"],[1,"h-16","flex","items-center","justify-center","text-gray-300"],[1,"w-1","h-1","bg-gray-300","rounded-full"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],["class","border border-gray-200 rounded-lg p-4",4,"ngFor","ngForOf"],[1,"border","border-gray-200","rounded-lg","p-4"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"space-y-3"],["class","p-3 rounded-lg border-l-4 cursor-pointer transition-all hover:shadow-md",3,"border-left-color","background-color","click",4,"ngFor","ngForOf"],["class","text-center py-4 text-gray-400",4,"ngIf"],[1,"p-3","rounded-lg","border-l-4","cursor-pointer","transition-all","hover:shadow-md",3,"click"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"font-medium","text-gray-900","text-sm"],[1,"text-xs","text-gray-600","mt-1"],[1,"flex","items-center","mt-2","space-x-4","text-xs","text-gray-500"],[1,"flex","items-center"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-3","h-3","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 11a3 3 0 11-6 0 3 3 0 016 0z"],["class","px-3 py-1 text-xs bg-green-600 hover:bg-green-700 text-white rounded transition-colors cursor-pointer",3,"title","click",4,"ngIf"],["class","px-3 py-1 text-xs bg-blue-600 text-white rounded cursor-not-allowed opacity-75",3,"title",4,"ngIf"],["class","px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors cursor-pointer",3,"title","click",4,"ngIf"],[1,"ml-2"],[1,"w-3","h-3","rounded-full"],[1,"px-3","py-1","text-xs","bg-green-600","hover:bg-green-700","text-white","rounded","transition-colors","cursor-pointer",3,"click","title"],[1,"px-3","py-1","text-xs","bg-blue-600","text-white","rounded","cursor-not-allowed","opacity-75",3,"title"],[1,"px-3","py-1","text-xs","bg-blue-600","hover:bg-blue-700","text-white","rounded","transition-colors","cursor-pointer",3,"click","title"],[1,"text-center","py-4","text-gray-400"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-8","h-8","mx-auto","mb-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"],[1,"text-sm"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50",3,"click"],[1,"relative","top-20","mx-auto","p-5","border","w-96","shadow-lg","rounded-md","bg-white",3,"click"],[1,"mt-3"],[1,"text-gray-400","hover:text-gray-600",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5","text-gray-400","mr-3"],[1,"text-sm","text-gray-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],[1,"mt-6","flex","justify-between"],["class","flex space-x-2",4,"ngIf"],[1,"flex","space-x-2"],["class","px-3 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 cursor-pointer",3,"title","click",4,"ngIf"],["class","px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md cursor-not-allowed opacity-75",3,"title",4,"ngIf"],["class","px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 cursor-pointer",3,"title","click",4,"ngIf"],["title","Delete the video call for this class","class","px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 cursor-pointer",3,"click",4,"ngIf"],[1,"flex","space-x-3"],[1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-100","rounded-md","hover:bg-gray-200",3,"click"],[1,"relative"],[1,"px-4","py-2","text-sm","font-medium","text-white","rounded-md","hover:opacity-90",3,"click"],["class","absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border border-gray-200",4,"ngIf"],[1,"px-3","py-2","text-sm","font-medium","text-blue-700","bg-blue-100","rounded-md","hover:bg-blue-200",3,"click"],[1,"px-3","py-2","text-sm","font-medium","text-red-700","bg-red-100","rounded-md","hover:bg-red-200",3,"click"],[1,"px-3","py-2","text-sm","font-medium","text-white","bg-green-600","rounded-md","hover:bg-green-700","cursor-pointer",3,"click","title"],[1,"px-3","py-2","text-sm","font-medium","text-white","bg-blue-600","rounded-md","cursor-not-allowed","opacity-75",3,"title"],[1,"px-3","py-2","text-sm","font-medium","text-white","bg-blue-600","rounded-md","hover:bg-blue-700","cursor-pointer",3,"click","title"],["title","Delete the video call for this class",1,"px-3","py-2","text-sm","font-medium","text-white","bg-red-600","rounded-md","hover:bg-red-700","cursor-pointer",3,"click"],[1,"absolute","right-0","mt-2","w-48","bg-white","rounded-md","shadow-lg","z-10","border","border-gray-200"],[1,"py-1"],[1,"flex","items-center","w-full","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-100",3,"click"],[1,"mr-3"],[1,"space-y-4",3,"ngSubmit"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["name","day",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","name","time","placeholder","e.g., 17:30 - 20:30",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],["type","text","name","location",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],["type","text","name","lecturer",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"flex","justify-end","space-x-3","pt-4"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-100","rounded-md","hover:bg-gray-200",3,"click"],["type","submit",1,"px-4","py-2","text-sm","font-medium","text-white","bg-blue-600","rounded-md","hover:bg-blue-700"],[3,"value"],[1,"text-center","py-12"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-12","w-12","text-gray-400"],[1,"mt-2","text-sm","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"]],template:function(e,i){e&1&&(o(0,"app-page-layout",0),v("sidebarToggle",function(a){return i.onSidebarToggle(a)}),g(1,xe,9,0,"div",1)(2,Je,24,7,"div",2),l()),e&2&&(u("isSidebarOpen",i.isSidebarOpen),d(),u("ngIf",i.isLoading),d(),u("ngIf",!i.isLoading))},dependencies:[Q,Y,Z,se,oe,le,ae,X,re,ee,te,ne,ie,de],encapsulation:2})};export{ue as TimetableComponent};
