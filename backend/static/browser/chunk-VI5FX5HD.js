import{a as ne}from"./chunk-OZJDGWV2.js";import{a as G,b as z,c as U,d as q,e as Y,f as $,g as J,i as K,j as Q,k as X,n as Z,q as ee}from"./chunk-DHWRSAE3.js";import{a as te}from"./chunk-R3RPSZJZ.js";import{b as H}from"./chunk-E25IYVGI.js";import{Ba as N,Ea as j,Fa as W,G as l,Ga as P,Ha as O,I as S,J as R,Ja as B,N as b,U as p,V as n,W as i,X as g,Y as C,Z as _,_ as m,a as M,b as k,h as V,i as I,ia as a,ja as E,ka as f,l as T,na as v,oa as y,pa as w,ta as D,u as d,v as u,va as L,w as x,wa as F,x as h}from"./chunk-X3WSSSVM.js";var re=(c,t,e,r)=>({"bg-green-100 text-green-800":c,"bg-blue-100 text-blue-800":t,"bg-yellow-100 text-yellow-800":e,"bg-red-100 text-red-800":r});function ae(c,t){c&1&&(n(0,"div",27),g(1,"div",28),n(2,"span",29),a(3,"Loading announcements..."),i()())}function se(c,t){if(c&1){let e=C();n(0,"div",30),x(),n(1,"svg",31),g(2,"path",7),i(),h(),n(3,"h3",32),a(4,"No announcements yet"),i(),n(5,"p",33),a(6,"Get started by creating your first announcement."),i(),n(7,"div",34)(8,"button",35),_("click",function(){d(e);let o=m();return u(o.openCreateModal())}),a(9," Create Announcement "),i()()()}}function le(c,t){c&1&&(n(0,"span",53),x(),n(1,"svg",16),g(2,"path",54),i(),a(3," Pinned "),i())}function ce(c,t){if(c&1&&(n(0,"span",55),a(1),i()),c&2){let e=m().$implicit,r=m(2);l(),f(" Expires ",r.formatDate(e.expires_at)," ")}}function me(c,t){if(c&1){let e=C();n(0,"div",38)(1,"div",39)(2,"div",40)(3,"div",41)(4,"h3",9),a(5),i(),n(6,"span",42),a(7),L(8,"titlecase"),i(),b(9,le,4,0,"span",43),i(),n(10,"p",44),a(11),i(),n(12,"div",45)(13,"span"),a(14),i(),b(15,ce,2,1,"span",46),i()(),n(16,"div",47)(17,"button",48),_("click",function(){let o=d(e).$implicit,s=m(2);return u(s.editAnnouncement(o))}),x(),n(18,"svg",49),g(19,"path",50),i()(),h(),n(20,"button",51),_("click",function(){let o=d(e).$implicit,s=m(2);return u(s.deleteAnnouncement(o))}),x(),n(21,"svg",49),g(22,"path",52),i()()()()()}if(c&2){let e=t.$implicit,r=m(2);l(5),E(e.title),l(),p("ngClass",D(9,re,e.priority==="low",e.priority==="normal",e.priority==="high",e.priority==="urgent")),l(),f(" ",F(8,7,e.priority)," "),l(2),p("ngIf",e.is_pinned),l(2),E(e.content),l(3),f("Created ",e.created_at?r.formatDate(e.created_at):"Unknown"),l(),p("ngIf",e.expires_at)}}function de(c,t){if(c&1&&(n(0,"div",36),b(1,me,23,14,"div",37),i()),c&2){let e=m();l(),p("ngForOf",e.announcements)}}function ue(c,t){if(c&1){let e=C();n(0,"div",56)(1,"div",57)(2,"div",58)(3,"div",59)(4,"h3",9),a(5),i(),n(6,"button",60),_("click",function(){d(e);let o=m();return u(o.closeModal())}),x(),n(7,"svg",61),g(8,"path",62),i()()(),h(),n(9,"form",63)(10,"div")(11,"label",64),a(12," Title * "),i(),n(13,"input",65),w("ngModelChange",function(o){d(e);let s=m();return y(s.newAnnouncement.title,o)||(s.newAnnouncement.title=o),u(o)}),i()(),n(14,"div")(15,"label",66),a(16," Content * "),i(),n(17,"textarea",67),w("ngModelChange",function(o){d(e);let s=m();return y(s.newAnnouncement.content,o)||(s.newAnnouncement.content=o),u(o)}),i()(),n(18,"div")(19,"label",68),a(20," Priority "),i(),n(21,"select",69),w("ngModelChange",function(o){d(e);let s=m();return y(s.newAnnouncement.priority,o)||(s.newAnnouncement.priority=o),u(o)}),n(22,"option",70),a(23,"Low"),i(),n(24,"option",71),a(25,"Normal"),i(),n(26,"option",72),a(27,"High"),i(),n(28,"option",73),a(29,"Urgent"),i()()(),n(30,"div",74)(31,"label",3)(32,"input",75),w("ngModelChange",function(o){d(e);let s=m();return y(s.newAnnouncement.is_pinned,o)||(s.newAnnouncement.is_pinned=o),u(o)}),i(),n(33,"span",76),a(34,"Pin this announcement"),i()()(),n(35,"div")(36,"label",77),a(37," Expiry Date (Optional) "),i(),n(38,"input",78),w("ngModelChange",function(o){d(e);let s=m();return y(s.expiryDateString,o)||(s.expiryDateString=o),u(o)}),i()(),n(39,"div")(40,"label",79),a(41," Attachment (Optional) "),i(),n(42,"input",80),_("change",function(o){d(e);let s=m();return u(s.onFileSelected(o))}),i()(),n(43,"div",81)(44,"button",82),_("click",function(){d(e);let o=m();return u(o.closeModal())}),a(45," Cancel "),i(),n(46,"button",83),_("click",function(o){d(e);let s=m();return u(s.saveAnnouncement(o))}),a(47),i()()()()()()}if(c&2){let e=m();l(5),f(" ",e.editingAnnouncement?"Edit Announcement":"Create New Announcement"," "),l(8),v("ngModel",e.newAnnouncement.title),l(4),v("ngModel",e.newAnnouncement.content),l(4),v("ngModel",e.newAnnouncement.priority),l(11),v("ngModel",e.newAnnouncement.is_pinned),l(6),v("ngModel",e.expiryDateString),l(8),p("disabled",e.submitting),l(),f(" ",e.submitting?"Saving...":e.editingAnnouncement?"Update":"Create"," ")}}var ie=class c{constructor(t,e,r){this.communicationService=t;this.authService=e;this.cdr=r}classRepRole=null;announcements=[];loading=!0;submitting=!1;showModal=!1;editingAnnouncement=null;newAnnouncement={title:"",content:"",priority:"normal",is_pinned:!1,expires_at:null,attachment:null};selectedFile=null;expiryDateString="";ngOnInit(){this.loadClassRepRole(),this.loadAnnouncements()}loadClassRepRole(){let t=this.authService.getCurrentUser();t?.class_rep_role?this.classRepRole={id:t.class_rep_role.id,user:t.id,user_name:t.full_name||`${t.first_name} ${t.last_name}`.trim(),user_registration_number:t.registration_number,student_class:t.class_rep_role.student_class,student_class_name:t.class_rep_role.student_class_name,permissions:t.class_rep_role.permissions,permissions_display:t.class_rep_role.permissions.map(e=>({send_announcements:"Send Announcements",moderate_messages:"Moderate Messages",view_all_messages:"View All Messages",manage_polls:"Manage Polls",send_notifications:"Send Notifications"})[e]||e),is_active:t.class_rep_role.is_active,assigned_by:0,assigned_by_name:"",assigned_at:"",created_at:"",updated_at:""}:this.classRepRole={id:1,user:t?.id||0,user_name:t?.full_name||"",user_registration_number:t?.registration_number||"",student_class:1,student_class_name:"Class of 2029",permissions:["send_announcements"],permissions_display:["Send Announcements"],is_active:!0,assigned_by:0,assigned_by_name:"",assigned_at:"",created_at:"",updated_at:""}}loadAnnouncements(){this.loading=!0,this.communicationService.getAnnouncements().subscribe({next:t=>{t&&typeof t=="object"&&"results"in t?this.announcements=t.results:this.announcements=Array.isArray(t)?t:[],this.loading=!1,this.cdr.detectChanges()},error:t=>{this.loading=!1,this.cdr.detectChanges(),this.announcements=[]}})}openCreateModal(){this.editingAnnouncement=null,this.newAnnouncement={title:"",content:"",priority:"normal",is_pinned:!1,expires_at:null,attachment:null},this.selectedFile=null,this.expiryDateString="",this.showModal=!0}editAnnouncement(t){this.editingAnnouncement=t,this.newAnnouncement=M({},t),this.expiryDateString=t.expires_at?this.formatDateForInput(t.expires_at):"",this.selectedFile=null,this.showModal=!0}closeModal(){this.showModal=!1,this.editingAnnouncement=null,this.newAnnouncement={title:"",content:"",priority:"normal",is_pinned:!1,expires_at:null,attachment:null},this.selectedFile=null,this.expiryDateString="",this.cdr.detectChanges()}onFileSelected(t){let e=t.target.files[0];e&&(this.selectedFile=e)}saveAnnouncement(t){if(t&&(t.preventDefault(),t.stopPropagation()),!this.newAnnouncement.title||!this.newAnnouncement.content||this.submitting)return;this.submitting=!0,this.expiryDateString?this.newAnnouncement.expires_at=new Date(this.expiryDateString).toISOString():this.newAnnouncement.expires_at=null;let e=k(M({},this.newAnnouncement),{student_class:this.classRepRole?.student_class||1,attachment:null});(this.editingAnnouncement?this.communicationService.updateAnnouncement(this.editingAnnouncement.id,e):this.communicationService.createAnnouncement(e)).pipe(I(3e4),T(o=>(this.submitting=!1,this.cdr.detectChanges(),alert("Save operation failed: "+(o.message||"Request timed out")),V(()=>o)))).subscribe({next:o=>{if(this.editingAnnouncement){let s=this.announcements.findIndex(A=>A.id===this.editingAnnouncement.id);s!==-1&&(this.announcements[s]=o)}else this.announcements.unshift(o);this.submitting=!1,this.cdr.detectChanges(),this.closeModal()},error:o=>{this.submitting=!1,this.cdr.detectChanges(),alert("Error saving announcement: "+(o.error?.detail||o.message||"Unknown error"))}})}deleteAnnouncement(t){confirm("Are you sure you want to delete this announcement?")&&this.communicationService.deleteAnnouncement(t.id).subscribe({next:()=>{let e=this.announcements.findIndex(r=>r.id===t.id);e!==-1&&this.announcements.splice(e,1)},error:e=>{console.error("Error deleting announcement:",e)}})}formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatDateForInput(t){let e=new Date(t),r=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),A=String(e.getHours()).padStart(2,"0"),oe=String(e.getMinutes()).padStart(2,"0");return`${r}-${o}-${s}T${A}:${oe}`}static \u0275fac=function(e){return new(e||c)(S(ne),S(H),S(N))};static \u0275cmp=R({type:c,selectors:[["app-announcements"]],decls:33,vars:7,consts:[["pageTitle","Class Announcements","pageSubtitle","Manage announcements for your class"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","p-6","mb-8"],[1,"flex","items-center"],[1,"flex-shrink-0"],[1,"w-12","h-12","bg-blue-100","rounded-full","flex","items-center","justify-center"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-9 0a2 2 0 00-2 2v14a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2M9 9h6m-6 4h6m-6 4h4"],[1,"ml-4","flex-1"],[1,"text-lg","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600"],[1,"flex","items-center","space-x-4"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors","inline-flex","items-center",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6v6m0 0v6m0-6h6m-6 0H6"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-xs","font-medium","bg-green-100","text-green-800"],["fill","currentColor","viewBox","0 0 20 20",1,"w-3","h-3","mr-1"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200"],[1,"px-6","py-4","border-b","border-gray-200"],[1,"text-xl","font-semibold","text-gray-900"],[1,"text-sm","text-gray-600","mt-1"],[1,"p-6"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","text-center py-12",4,"ngIf"],["class","space-y-4",4,"ngIf"],["class","fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",4,"ngIf"],[1,"flex","justify-center","items-center","py-8"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"ml-3","text-gray-600"],[1,"text-center","py-12"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"mx-auto","h-12","w-12","text-gray-400"],[1,"mt-2","text-sm","font-medium","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],[1,"mt-6"],[1,"bg-blue-600","hover:bg-blue-700","text-white","px-4","py-2","rounded-lg","font-medium","transition-colors",3,"click"],[1,"space-y-4"],["class","border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow",4,"ngFor","ngForOf"],[1,"border","border-gray-200","rounded-lg","p-6","hover:shadow-md","transition-shadow"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","space-x-3","mb-2"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium",3,"ngClass"],["class","inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",4,"ngIf"],[1,"text-gray-700","mb-3"],[1,"flex","items-center","text-sm","text-gray-500"],["class","ml-4",4,"ngIf"],[1,"flex","items-center","space-x-2","ml-4"],[1,"text-blue-600","hover:text-blue-800","p-2","rounded-lg","hover:bg-blue-50","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"text-red-600","hover:text-red-800","p-2","rounded-lg","hover:bg-red-50","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-purple-100","text-purple-800"],["d","M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"],[1,"ml-4"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","overflow-y-auto","h-full","w-full","z-50"],[1,"relative","top-20","mx-auto","p-5","border","w-11/12","md:w-2/3","lg:w-1/2","shadow-lg","rounded-md","bg-white"],[1,"mt-3"],[1,"flex","items-center","justify-between","pb-4","border-b","border-gray-200"],[1,"text-gray-400","hover:text-gray-600","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"mt-6","space-y-6"],["for","title",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","text","id","title","name","title","placeholder","Enter announcement title","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["for","content",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","content","name","content","rows","6","placeholder","Enter announcement content","required","",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["for","priority",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["id","priority","name","priority",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["value","low"],["value","normal"],["value","high"],["value","urgent"],[1,"flex","items-center","space-x-6"],["type","checkbox","name","is_pinned",1,"rounded","border-gray-300","text-blue-600","shadow-sm","focus:border-blue-300","focus:ring","focus:ring-blue-200","focus:ring-opacity-50",3,"ngModelChange","ngModel"],[1,"ml-2","text-sm","text-gray-700"],["for","expires_at",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","datetime-local","id","expires_at","name","expires_at",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"ngModelChange","ngModel"],["for","attachment",1,"block","text-sm","font-medium","text-gray-700","mb-2"],["type","file","id","attachment","accept",".pdf,.doc,.docx,.jpg,.jpeg,.png",1,"w-full","px-3","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-blue-500",3,"change"],[1,"flex","items-center","justify-end","space-x-3","pt-6","border-t","border-gray-200"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","transition-colors",3,"click"],["type","button",1,"px-4","py-2","text-sm","font-medium","text-white","bg-blue-600","border","border-transparent","rounded-lg","hover:bg-blue-700","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"click","disabled"]],template:function(e,r){e&1&&(n(0,"app-page-layout",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),x(),n(6,"svg",6),g(7,"path",7),i()()(),h(),n(8,"div",8)(9,"h3",9),a(10),i(),n(11,"p",10),a(12),i()(),n(13,"div",11)(14,"button",12),_("click",function(){return r.openCreateModal()}),x(),n(15,"svg",13),g(16,"path",14),i(),a(17," Create Announcement "),i(),h(),n(18,"span",15),x(),n(19,"svg",16),g(20,"path",17),i(),a(21),i()()()(),h(),n(22,"div",18)(23,"div",19)(24,"h2",20),a(25,"Recent Announcements"),i(),n(26,"p",21),a(27,"Manage your class announcements"),i()(),n(28,"div",22),b(29,ae,4,0,"div",23)(30,se,10,0,"div",24)(31,de,2,1,"div",25),i()()(),b(32,ue,48,8,"div",26),i()),e&2&&(l(10),f(" ",r.classRepRole?"Class Representative - "+r.classRepRole.student_class_name:"Student Access"," "),l(2),f(" ",r.classRepRole?"You have permission to send announcements to your class":"You can access announcements (testing mode)"," "),l(9),f(" ",r.classRepRole?"Active":"Testing"," "),l(8),p("ngIf",r.loading),l(),p("ngIf",!r.loading&&r.announcements.length===0),l(),p("ngIf",!r.loading&&r.announcements.length>0),l(),p("ngIf",r.showModal))},dependencies:[B,j,W,P,ee,J,Q,X,z,G,K,U,q,Z,$,Y,te,O],encapsulation:2})};export{ie as AnnouncementsComponent};
